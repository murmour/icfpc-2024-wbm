ICFP Programming Contest 2024 submission by WILD BASHKORT MAGES.

Behold, our write-up:
```
B$ L! B$ L" B$ B$ B$ v! L# L$ L% ? B= BT I" v% S} B. BD I" BT I# v% B$ B$ v# v$ v" ? B= v$ I" S ? B= B% v$ I# I! B$ B$ v# B/ v$ I# BD I# v% B$ B$ v# B/ v$ I# BD B- U# BT I# v% I} v% I&RhaR?_/clL@q-_-}{r'WO~.1W[*\4zt(BagQ^^4%f\!A"&78Y'gk~9EKfDfM^v<>B>xwE_Vl|aXl'J_w<*Cc;;Boi)]^y0JwdjD1->}U$O~b&qnw&Dv:yoWqNF&@3@'0-HzN([|GlCE))Eg(ARhiM\bV,X+r>qO!6~_f3?!*@&,~5C1J^M&^CW`b@*aG>OC8_>`0p47g&y4u;&g,6g-=y)|\yqX2:v2s!w\9c?}WUlm\J{dFW.C)*}![c;^w]l.QInrY:d{mUk&Q0(mo4-K<t1Gp'mfz{62j_1VlpR2wJ(@_+PRgscJv,nT72&MN;KU#4Eq%5B>WAo'=j`"A#kM>?b\:8-<3aK[(k4DYN.Jya$G>4YdX$^:{N^^h;XKma$-LJ95S?tSY\+N'!Dt0]{zu9b?*<0O`Saky\e}Tf%J48cH^f~31oSlq67pG/OW=vaE}i)1kDECABj,=5R3iyD/>-i-%E*dK..ZvUgxfb2.[+k!22qdtMn_{\N`gJ#E2VU=y`v1+p3N*sgH#u.GnE{sSnU}&z_}E7=@aLWKAEV':HHg@w%haUX]t4lI$RiPru=m1]l)cw=z6Y[:Ewdyd&&#esA?*Xao,A20,);F{65yJ1Z{/CV#jww/F][QvC8G`r?;N5kB)9LX9"4&ue^;="kc?h>hb7Mkbyq4DMJvWHkRA=.sh{#0q6>7Ocf:Z]^K\o3X,~w-nCryBC-[o}DHZJvNzY75YOg!e;j|T%rz7[,$+HH~{Q7UV8^g`,}3"]U7mGVZ}O{N@d}Z%YFA,7md#T^{!BUa&y]vF=BK5I?3m.>1^j1o9|%+<N^(mG5"*W,f~dDp4cEJ5%i2vU!Y6GQ^UOPJl.5g+HB=cE-zY-4f!EaY<ZI`S@HFgF/6nWuId]uT5dmv'n_2Z.2H)Rjffh:0:{<($Ht>h4LK'BXG}5ql"oLEu:D7g_R{+A^-,|I2i-6DN0@{G$fHXVUbBbhw'?u/j+KOF<0'[(XH/&L[:AG<@/.k?7=V.9u-c5C}Y(uSN6@-~YBOF1DTCbFrP~23CaE;0BV$=N!ddB83^K/hZ]K6X*iwYob`"(2H7z`B(\V}q+0WIvS}k4`\V0hR1>@[(tr#5s}6{{Q;wXLlnL!(kRV]uP_l.y2d;+bse-V|Ur4a?s"h1E#FOPvOy278DRM4ci}4M9(Yts0Hk_h9MolN`iS=2>RibS3r%K>bIb.F8Q`,O)/,jn[S*S}g!\I:i{9`6S?3..6.&p:dzU6lZr77/4*tI2[+Di'N&r$F@!4AJ@'EVhh:U%;q&==2?J>#sx">yc(#,cWpNy(+0:.ZWsQTwO+T3cdEW1n8jqERsf{*VC!G1l-dilM*<mYT%gFij(p+N8tm3<`zA]+":a=M}X=?$4|w|%zPmN,Xa#\<vbdcN/I4$_kNBjsb5N&cTHtkTVMf_Fvrc6~^M^jHo/g[kQaNU#5m!*PQ=+RR-fnrt!Q{$x5z]d=[0h;wYBu3\l^T`A2,vfe(}yY{s\75Yg4a!.vNbPO*"Y$e;uPaGh#P+o(P=aaRvw2AL9&s1*{23>H53kCc0Y3qfOxYkqM8l+#)2co2.<qig33Wt,>;4MkY5>OqH%Q%[-<SF_HX!BJO=,h1qPQHwQ"*$(kCkEF]_LW[fQ&8|7~</2X2>e)0h,Y:ZZ2dsJ>-6\HKm}0Og5"7<D+d[EN}ChL}0aXM_ZT.:wsj^?8+UXC"X|4X/Lh||sL$bRsdm=J2lYP{H'V&yT{(#^QLQ;Rd`JIPuSF]vaClCO=lx<Nex:RiPy!,n1qb3H!*9z&XeO<="!6wKz`RzG|Gn[{.[b-$9W:@.5M,p/rhVwp`8&*cVjC&l#'iYz8:z=kVxn%@\Xs6.i/<R&V;@``|L,96k)E[>,Coi`SHj'6-S}'jgq16q,sEzx)!JD)x'XH<^|A>FyU8t9wQ;+9&4]"#_wvC-wxx,/fd>gUL|Z_:d>0wzpzx]v!.Bvp!^,<eQ<wJkZP:\ySkvz=Nb4[|,\2e]%`vL,6,eo;q_%t~[F0`KT6uPJHP,_Crsup=EgDHbIks<'ht6J@F9#|)<D%`280v8[!DM1'&;\ZH"h.1mmoLr#Ewl>'m6{KS]XJOX-K%eK"hR3.2InN5u\zs(qW<|+.^Xn@"lH]<65Hp%W0x[f"`)5rwb%?Gv8*DJ@}&LAP"ru)/eI&*.$w7XS(@@FfqTXP\U#Mf3wI71E[sThT<biN^HIy76$,g$jHK!V}wTs@)YYCRXIJ8imC{%nT.QufX7R!r:Pk^|9g6HLtht^R@mp3"'|_v]qM?u1;PheRZX2x5Y[{L[u#MMc|tu_8c1%M0mlqP|YG7SG"yg}w$h+E6d4dc2NbyO:p+Sf2gt1Y,c{Uvx.9*YBm>o4Di*,1+xGvg{-3QZvr"K$B{0\rn'}<)E9G]-+~9S+-5A6U1\%55%<~=<]J@(LrOt&U-vR&F`3vmX/MbUM<N0-a5%XGnT4M/Gi_z!T4fDhdF/__{EcOyBkt.jq:h%.gwLb9^qmQB'bfQKh'f>0OM^f%RHc4;w%K>Ft^Ar)a)5@;Az^"c}h0Hy#=U=$~V5:;~OiG-^FZKKf=F8EO*8QT$JODc;>2ldGfa4_=m"Ur_4trwK7x2&&Z&0it;2jH:NfA{[z.}K!2|RIqd#Wgw!eWSsUnZTm%#NE(O*"4}lNP;g0ZUk%({{{8>LDvD/bT-Ri#l}Cak[&_qbhVBwJ!8J#.]wbrTq_/giT=$);/^NOJnx"!zNo~EPV-|;pMf5}ZGQ5w|}!3@az5Oqe'S:hj2aD\?zVB5Tn+!PB:PfMgyzp&es3p[1duB8~,As%E2SWchsEXErtWtV7mC5J]>S/;y)Z4"bj`I[^RPjFGdp76s@LP/:Vpj(}#0o4Z-k0$9r]xu=U_|E*^fJw18U_Z!,i2o+F7Ll/yPh2btvtzc<%_kDj]9'_Vo/8u>u7RQL*B=45(HkQ7#9f".etnSt^}U4|ie;zYbkCFyLo$#`&2qm;L)A[lvk{`}YS?/q-\[l|`iJd|_Vy;p<0m]+o)Soi*"!Ka4Jp.TZ9gq762`dI%@rTreno9[IV!EsQ_FUfM@r!PDEh)6{z"k-Gc3?E:z1MG.!}cqgc}XOl4YMs v" S#5";"+"#}3"#}$}-"#}."'"#}7}{}y"o"k"C"?"#}v"+"'"#}u}X}:"'"#}?}_"#}K}i}&"#}l"#}j"#}M"'"#}J}C"'"#}>}<"'"#}[}*}U}/"#})}!#A"+"'"#}(},}4"k"c"7"3"'"#}L}="#}z"#}n}Y}m"G"C"/"'"#}Z}V"#}@}`"/"'"#}p}^"#}B}O}1}8}9"#}'}5"#}2"3"/"#}f"#}Q"#}e}W}""#}6"'"#}F};}k"K"#}%"'"#}#}~";"'"#}G}g"/"#}N"#}I"#}o}w}+}0}} L! B$ L" B$ v! B$ v" v" L" B$ v! B$ v" v"
```
