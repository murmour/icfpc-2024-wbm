ICFP Programming Contest 2024 submission by WILD BASHKORT MAGES.

Behold, our write-up:
```
B$ L! B$ L" B$ B$ B$ v! L# L$ L% ? B= BT I" v% S} B. BD I" BT I# v% B$ B$ v# v$ v" ? B= v$ I" S ? B= B% v$ I# I! B$ B$ v# B/ v$ I# BD I# v% B$ B$ v# B/ v$ I# BD B- U# BT I# v% I} v% I'MF6I@"""Kb^1fUUlnu3n_+}"a't6%3C2xR<GHqo-~/4)KH|uln+>mmlr:tHrQ%!!V+4nF0\/fKE-u9E<2fHR1>g1<|p#IL'uz1BqW*HL-Z~`'8~rW4j,4wM~!)>S^&FC@]4xKj_uhhSD%s*QP*93-E4.7)s^F?4Y]fu4x88\CA~l1S!80Z%A{&"5/#o?cEZR}WD,`%%}d1E\eKk>U)UxN-@e35X)h0x(S<]):~l/:JtPGNbcBkW8htIr]^V9a))R5j/"5^9?sPS7w>tfZSC9oXMnXin^_ajvqcN,_=/K<D/m\aD!)**P<,k=VX~;EL0vkl27ql81{ZZ?|)[W:aO;LD>sQ..|oo7w'9;ma[TBiMhGU43jcN"UGtjT#D)/|Z6@vAV'%x/B}VdHt*>t+!%TT~ZqQ0<&>"S}A[rm2M5pE&5{]R+5/B1ez*A`eIG'b@d>E~zA%VI?E_M4'Fwj=r'l%y/:XhZhy./$a!m-<)#{eBg-jo2_!!k3g1@?:3eq636ND]2\'#sg(xS??_~{g?Zp}qFJ+NFo0Iid%YP4E`Gp.!6C/lIg[&'\[Y3<p>bc^O.$Tq%D%rNW\VxbvcE5.@Sp)U$.WB(%=!gojT=Ven;xUDE!y>-mwq~57@LJ(y6a4#x[bBxVz#~IYdy^a;xjK4H|{p1.%+o-xY<M\o'9T(mkdIR5@f_P`rI7,!r='<7k!BSE=jaW$22@r%bM^WWh)Sf[mO?D3Mwv`tJpZ,Cq!1KSh(6^1|lUF1.>!x$(0nqwbsWG+"YTJqe.f]cu2R2H~xFt7y<m_.o>r^*aNT:^Ig"&5?hAhqb"b02,w^Fn-V@CU:5JvU7B*x<?G\cg.(GvDffEej3_/zn)8>]*!*Au%$wx`@p"H)\'V6vBic"+?{3Fc]rDbSg\+45pNY9GrY{T'TF1!lq#I[]ar:e:hOnHc2>#!'TKYB::>D(!b|kkGC%{oovp#R*)b;%Kz*&NSo#G*v+_>7D\%MD`qlehfO2)JQ(52VK9{Do{$EbS)"x~nCNtNEN69Kpt8vqHfs,)Wli9]ZrUjk}G*B4i`"[5x7_2ENIot_q"I".'-fd>a]n`nF'A=URO)%hz]zo,s?`ae:bx,2q/EvxB:Vgv,+z#S`qv@Kp_<NHaqPUDtuWea/_QU*KURy`{>BcUhW6=.RFp(m|KOoN%iqcPP99#QUHbPCGH:@<.B-0mH|?_]A<2&_6nHj3BEsJk!v(#Uu.PJ0AIs'={2xxG`:'7CvB@x5/AwW6(Hl8cUz*wrU6yC0xhAA3_<?:GsXEoi';!WOK?WS(K2qzFT(Zo\N6-%pY\YFvc>!VT?(^u1YE@fNv3.]<-D+Q_lV0+pJsN8<~t"{mz(%TGs(=ZFT?!;+cVTYbu`Y&zNN/jSM"<PM2bYoMwY3|:|$l(rW{I9wn;Ri;A~.AfQ.5%b9J5IWAZ)"?TC*"r.Qo!6m<qjtFSw\/+bo.@v[q_R{^Adh:bPLYD:wbP7k'8:+UgivZa|z)Wu0{1Xz4(P'vK[=LjPPBV~\KiBK<8K3y\"$J_tEYc6NVa]GF:1CK{A+moAs>[Z\)jd/1b(iiZM~'Jri69Wv=<lKo}7ra<p"-kJ(Tl(<tT~2HN<`n(h+$jof5,r-#llbtd&VVR_$1b:1+-4.Ff5W]%,?`:7~Rk<NJ*2DxO4y<8I+K5:yO.jB.^!*0B1ie`SD[}sLMH=RL@*Vs0`"8VW@.E3x-#wW=|g;#odWUCH~9oKtXx"WS_$V!j&WIXoZP%n^1#f]jKS'-{{W*=_xJ)$W*bA6xeSSEj!41|FWp^XtgR"#r3=8VI%9lf1K3lbn&d,d})q$WN|3OR5'<Z)D+7O8bGn[e{-Rlp$[o2qEBohVE[Ux>i5h+A5=7.vR<HW8L+wrhN^Z"78|0.]<5x,P!?p`.'Z<qq*vM,=MRXW-@cqD3ZCJb?.aEut{&*#QC-Ps`4wx0{jh42.@M<DUQ`G{E3<qh\Wj)ZEf!.H0J;|*Bj1DASQ{U4_]yvi_y'r}Z;.K,JUV0Jo!w)N;!82`}-b\!1m{5D)!/kBni5hg<oFxT|VP;CZ@=BNuPxQ5XoEzO&gtB.B0f{96P@42aHQqGQ,UA'8vKL]DS0v~T!qxx|VuM=nU(^\C0I.9@%\2VgoZ~8:D?qSwqI[IjlSCk7zNj#)zng?9/7TZo+X0suI..UDZ}/Vqd!v<d)3zI>l]x,.>=4W#Am%+}rA,;C$thghh@o_X8s}Z("7jYTsMQ=YblPFq/5d<HOPt!?!=KMDttpK"lXNvoo='|%r1v\Vdih]R)s|f%3c7hfeLjd-$}aJvZi<Xu4z8?c~Nq]K$.j!{:~v:hC\{]l.NP*NqO)QeJ(8B,":$Dv?)ZUWVR]}$HE#t`T^Y{K~;S4wfsl!QAvyvM`CLeE+LYBi]8&q@>Hr}_qV<:]f7Y%fEb#MHpKg/[\Vv]PvYj0~k"L:qj]~>.tH63kw)iM,<=Q_lQ2><)G8K}@{D;"~4"s(?C]~(}=.H/3zC|\`iE1jrSeA:<m?t,ov2C{Q.D)@KOXpOx=P%0S/^?$*>p7D5t'%``F.b:nrfgGb]MFf4>Hx;8KasGFgoRfd'SodN=,r%@V/5yi<9gJ<V1-_OFv6'8`$/^GLocP\3zq4XM]4cxHN7*CO^:R}nyR?=4&"9rRCY5X^%5x<W!.EzO:L#S`1,SLH5XAwO$A9`((ZC0zMGxu>Zei_k_{o*g^8/JQvRp?s/D8JgU$.rLQR9n%a);S^$kn:O|6-Db@*"z&D]H|d9#v+f$gN8\iiHXqB}7_Y0^pI\m9+g(67+1a%U<UuQU-Ok>O&RacztPV'%,tFs`VF(p/m->2+$.-kcf~1{[fgB]:5'v=Ka4D)Ii\Hgo;-Ted-.E16iKV0[Bs>ViHX]tB2*0n#3<R_vp=KN5XZ&Fm/jTGD|B{&(IpgMXCYolYifpZ3guGMLjC*!L14)^c$^z$Aee2ja~Ben=-I~efQ}47{?Gt4W(s/3FULw"d29,9>C;'-w[3:LSy]]#8cbw^&GgOWzzrNAh+vwoByiUVDTE&M\/x=/]8lL8Z-d'`Xy}nF5@AJWXO2p2zG_itaYMQmc'|7&*>Ua_[rg]iF!G;f~#J#qUV[_*j)g v" S#5";"+"#}3"#}$}-"#}."'"#}7}{}y"o"k"C"#}&";"+"'"#}u}X}:"'"#}?}_"#}K}i}v"#}l"#}j"#}M"'"#}J}C"'"#}>}<"'"#}[}*}U}/"#})}!#A"k"g"#}("7"3"'"#}L}="#}z"#}n}Y}m"G"C"/"'"#}Z}V"#}@}`"/"'"#}p}^"#}B}O}1}8}9}4"+"#},"#}'}5"#}2"3"/"#}f"#}Q"#}e}W}""#}6"'"#}F};}k"K"#}%"'"#}#}0";"'"#}G}g"/"#}N"#}I"#}o}w}+}~}} L! B$ L" B$ v! B$ v" v" L" B$ v! B$ v" v"
```
